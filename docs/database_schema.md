# データベーススキーマ仕様書

`json-api-builder`によって生成されるSQLiteデータベースファイル（デフォルトでは `data.db` など）の内部構造について説明します。

## テーブル: `generic_data`

本ライブラリで作成されるデータベースには、`generic_data`という単一のテーブルのみが存在します。このテーブルは、リソースの種類（例: `items`, `users`）に関わらず、すべてのデータを一元的に格納するように設計されています。

### テーブル構造

| カラム名      | データ型     | 説明                                                                                                                            |
|---------------|--------------|---------------------------------------------------------------------------------------------------------------------------------|
| `id`          | `INTEGER`    | **プライマリキー**。各レコードを一意に識別するための自動採番されるID。                                                          |
| `resource_type` | `VARCHAR(50)`| このレコードがどのリソースに属するかを示す文字列（例: "items", "users"）。`APIBuilder.resource()`で指定した名前が入ります。 |
| `data`        | `TEXT`       | Pydanticモデルから生成された**JSON文字列**。アイテムの具体的なデータ（名前、価格など）がここに格納されます。                     |
| `created_at`  | `DATETIME`   | レコードが作成された日時（UTC）。自動的に設定されます。                                                                         |
| `updated_at`  | `DATETIME`   | レコードが最後に更新された日時（UTC）。作成時および更新時に自動的に設定されます。                                               |

### 設計思想

-   **汎用性**: `resource_type`カラムでリソースを区別し、`data`カラムにJSONを格納することで、どのようなデータ構造でも単一のテーブルで柔軟に扱えるようにしています。これにより、リソースを追加するたびにテーブルスキーマを変更する必要がなくなります。
-   **シンプルさ**: テーブル構造を一つに限定することで、ライブラリの内部実装と利用者の理解を簡素化しています。
-   **拡張性**: 主なデータはJSON文字列として`data`カラムに保持されるため、Pydanticモデルのフィールドを追加・変更しても、データベースのマイグレーションは不要です。

### データ例

`generic_data`テーブルに以下のようなレコードが保存されているとします。

| id  | resource_type | data                                                      | created_at          | updated_at          |
|-----|---------------|-----------------------------------------------------------|---------------------|---------------------|
| 1   | "items"       | `{"name": "商品A", "price": 1000}`                        | "2025-07-01 10:00:00" | "2025-07-01 10:00:00" |
| 2   | "users"       | `{"username": "user1", "age": 30}`                        | "2025-07-01 10:05:00" | "2025-07-01 10:05:00" |
| 3   | "items"       | `{"name": "商品B", "price": 2500}`                        | "2025-07-01 10:10:00" | "2025-07-01 10:15:00" |

これは、APIエンドポイントを通じて以下のように解釈されます。

-   `GET /items/` は `id=1` と `id=3` のレコードを返します。
-   `GET /users/` は `id=2` のレコードを返します。
