# 20250705_inquiry_summary.md

## 問い合わせ内容

PythonのデフォルトイベントループとWebサーバー（Uvicorn）のイベントループが衝突し、デッドロックが発生する問題の解決策について。
また、その解決策を、ユーザーが独自のカスタムロジック（AI連携など）を実装できるような、より汎用的な形で提供してほしい。

## 実施した変更の概要

イベントループの衝突問題を解決しつつ、ライブラリの拡張性を高めるため、以下の変更を実施しました。

### 1. カスタムルート追加機能の実装 (`AppBuilder.add_custom_route`)

-   `AppBuilder`クラスに、FastAPIの標準的な方法で任意のAPIエンドポイントを追加できる `add_custom_route` メソッドを新設しました。
-   これにより、ユーザーはCRUD操作以外にも、独自のビジネスロジック（例: 特定の計���、外部APIの呼び出し、AI連携など）を持つエンドポイントを自由に実装できます。

### 2. JSONインポート機能の非同期化と再設計

-   従来の同期関数 `generate_db_from_json_file` は、イベントループの衝突を引き起こす可能性があるため、**非推奨**としました。
-   代わりに、APIエンドポイント内から安全に呼び出せる非同期ヘルパー関数 `import_from_json_async` を新たに提供しました。
-   これにより、Webサーバーを停止することなく、APIリクエストを介して安全にデータベースへのデータインポートを実行できるようになりました。

### 3. 後方互換性の維持

-   既存の `add_resource` の仕様に変更はないため、これまで通りお使いいただけます。
-   非推奨となった `generate_db_from_json_file` も、警告（`DeprecationWarning`）を出す形で残してあるため、すぐには壊れませんが、早期の移行を推奨します。

## 影響範囲

-   **既存ユーザーへの影響**: なし。後方互換性は維持されています。
-   **新規���ーザーへの推奨**:
    -   データベースへのデータ投入は、`import_from_json_async` を使ったAPIエンドポイント経由での実行を推奨します。
    -   独自の機能は `add_custom_route` を使って自由に拡張してください。
